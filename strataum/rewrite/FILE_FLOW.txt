â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        FILE PUBLISHING & DOWNLOADING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¤ PUBLISH FLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Client sends:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /publish                  â”‚
â”‚  Authorization: Bearer TOKEN    â”‚
â”‚  Content-Type: multipart/form   â”‚
â”‚                                 â”‚
â”‚  File: library.str              â”‚
â”‚  name: greeting-lib             â”‚
â”‚  version: 1.0.0                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
        Express Server
            â†“
    Multer Middleware (Line 288)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ upload.single("tarball")    â”‚
    â”‚ Intercepts file upload      â”‚
    â”‚ Stores in memory buffer     â”‚
    â”‚ req.file.buffer (bytes)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    Convert to String (Line 304)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ const content =             â”‚
    â”‚  req.file.buffer            â”‚
    â”‚   .toString("utf-8")        â”‚
    â”‚                             â”‚
    â”‚ "func greet(name..." â† TEXT â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    Store in Registry (Line 305-312)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ registry.publish(           â”‚
    â”‚   "greeting-lib",           â”‚
    â”‚   "1.0.0",                  â”‚
    â”‚   description,              â”‚
    â”‚   "index.str",              â”‚
    â”‚   "MIT",                    â”‚
    â”‚   keywords,                 â”‚
    â”‚   content â† STORED HERE     â”‚
    â”‚ )                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    Store in Map Structure
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  registry.storage.packages       â”‚
    â”‚  {                               â”‚
    â”‚    "greeting-lib": [             â”‚
    â”‚      {                           â”‚
    â”‚        name: "greeting-lib",     â”‚
    â”‚        version: "1.0.0",         â”‚
    â”‚        content: "func greet...", â”‚  â† FILE CONTENT
    â”‚        author: "admin",          â”‚
    â”‚        description: "...",       â”‚
    â”‚        main: "index.str",        â”‚
    â”‚        license: "MIT",           â”‚
    â”‚        keywords: [...],          â”‚
    â”‚        createdAt: "..."          â”‚
    â”‚      }                           â”‚
    â”‚    ]                             â”‚
    â”‚  }                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    Response to Client
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 201 Created                 â”‚
    â”‚ {                           â”‚
    â”‚   "success": true,          â”‚
    â”‚   "message": "Published..." â”‚
    â”‚   "package": {...}          â”‚
    â”‚ }                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ“¥ DOWNLOAD FLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Client requests:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /package/greeting-lib/1.0.0      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
        Express Server (Line 353)
            â†“
    Look up in Registry (Line 354)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ registry.downloadPackage(        â”‚
    â”‚   "greeting-lib",                â”‚
    â”‚   "1.0.0"                        â”‚
    â”‚ )                                â”‚
    â”‚                                  â”‚
    â”‚ Searches Map structure:          â”‚
    â”‚ packages["greeting-lib"][v1.0.0] â”‚
    â”‚              â†‘                    â”‚
    â”‚         Returns content string   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    Set Response Headers (Line 360-361)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Content-Type: text/plain         â”‚
    â”‚ Content-Disposition: attachment; â”‚
    â”‚   filename="greeting-lib.str"    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    Send File Content (Line 362)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ res.send(content)                â”‚
    â”‚                                  â”‚
    â”‚ "func greet(name: string)..."    â”‚
    â”‚ "func goodbye(name: string)..."  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    Response to Client
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 200 OK                           â”‚
    â”‚ Content-Type: text/plain         â”‚
    â”‚ Content-Disposition: attachment  â”‚
    â”‚                                  â”‚
    â”‚ func greet(name: string)... [..] â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    Client saves to disk
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ greeting-lib.str (file on disk)  â”‚
    â”‚                                  â”‚
    â”‚ func greet(name: string) => ...  â”‚
    â”‚ func goodbye(name: string) => .. â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ”„ COMPLETE CYCLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. CREATE FILE
   library.str (on your computer)

2. PUBLISH
   curl -F "tarball=@library.str" \
        -F "name=greeting-lib" \
        -F "version=1.0.0" ...
   
   â†“ File sent to server
   â†“ Multer receives & buffers
   â†“ Converted to string
   â†“ Stored in registry Map
   
3. DOWNLOAD
   curl http://localhost:3000/package/greeting-lib/1.0.0
   
   â†“ Server looks up in Map
   â†“ Retrieves content string
   â†“ Sends as HTTP response
   â†“ Client saves to disk

4. VERIFY
   diff library.str greeting-lib.str
   âœ“ Files are identical


ğŸ’¾ STORAGE LAYERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Disk (Your Computer)
  library.str
       â†“
HTTP Request (multipart/form-data)
       â†“
Memory Buffer (Multer)
  req.file.buffer (bytes)
       â†“
Convert to String
  "func greet..." (UTF-8 text)
       â†“
In-Memory Registry (Map)
  registry.packages["greeting-lib"][1.0.0].content
       â†“
HTTP Response
  "func greet..."
       â†“
Disk (Your Computer)
  greeting-lib.str


âš™ï¸ KEY COMPONENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. MULTER (Line 207)
   const upload = multer({ storage: multer.memoryStorage() });
   
   Job: Intercept file uploads, store in RAM
   Output: req.file.buffer (bytes)

2. CONVERSION (Line 304)
   const content = req.file.buffer.toString("utf-8");
   
   Job: Convert bytes to text string
   Output: content (UTF-8 string)

3. REGISTRY (Class starting Line 31)
   class StrataumRegistry {
       storage.packages (Map)
   }
   
   Job: Store files as strings in Map
   Output: Quick lookup by name & version

4. HTTP (Line 353, 360-362)
   app.get("/package/:name/:version", ...)
   
   Job: Retrieve from Map, send to client
   Output: File content in HTTP response


âœ… SIMPLE FLOW SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Client File â†’ HTTP Upload â†’ Multer Buffer â†’ UTF-8 String â†’ Registry Map
Client File â† HTTP Download â† HTTP Response â† Registry Lookup â† Registry Map


ğŸ“Š DATA STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

registry.storage.packages (Map):
{
  "greeting-lib": [
    {
      name: "greeting-lib",
      version: "1.0.0",
      content: "func greet(...)",   â† ACTUAL FILE TEXT
      author: "admin",
      description: "...",
      main: "index.str",
      license: "MIT",
      keywords: ["greeting"],
      createdAt: "2026-01-12T..."
    }
  ]
}

Access:
  packages["greeting-lib"][0].content  â† Gets file text
  packages["greeting-lib"][0].version  â† Gets version
  packages["greeting-lib"].length      â† Gets version count


ğŸ¯ THAT'S IT!
â•â•â•â•â•â•â•â•â•â•â•â•â•

Files are just strings stored in a JavaScript Map.
Upload = store string in Map
Download = get string from Map, send back
